We define the notion of a trace kernel on a manifold M. Roughly speaking, it is a sheaf on M x M for which the formalism of Hochschild homology applies. We associate a microlocal Euler class to such a kernel, a cohomology class with values in the relative dualizing complex of the cotangent bundle over M and we prove that this class is functorial with respect to the composition of kernels. This generalizes, unifies and simplifies various results of (relative) index theorems for constructible sheaves, D-modules and elliptic pairs.