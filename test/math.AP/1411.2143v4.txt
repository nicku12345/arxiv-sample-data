Consider weakly nonlinear complex Ginzburg--Landau (CGL) equation of the form:  u_t+i(-\Delta u+V(x)u)=\epsilon\mu\Delta u+\epsilon \mathcal{P}( u),\quad x\in {R^d}\,, \quad(*)    under the periodic boundary conditions, where \mu\geqslant0 and \mathcal{P} is a smooth function. Let \{\zeta_1(x),\zeta_2(x),\dots\} be the L_2-basis formed by eigenfunctions of the operator -\Delta +V(x). For a complex function u(x), write it as u(x)=\sum_{k\geqslant1}v_k\zeta_k(x) and set I_k(u)=\frac{1}{2}|v_k|^2. Then for any solution u(t,x) of the linear equation (*)_{\epsilon=0} we have I(u(t,\cdot))=const. In this work it is proved that if equation (*) with a sufficiently smooth real potential V(x) is well posed on time-intervals t\lesssim \epsilon^{-1}, then for any its solution u^{\epsilon}(t,x), the limiting behavior of the curve I(u^{\epsilon}(t,\cdot)) on time intervals of order \epsilon^{-1}, as \epsilon\to0, can be uniquely characterized by a solution of a certain well-posed effective equation:  u_t=\epsilon\mu\triangle u+\epsilon F(u),  where F(u) is a resonant averaging of the nonlinearity \mathcal{P}(u). We also prove a similar results for the stochastically perturbed equation, when a white in time and smooth in x random force of order \sqrt\epsilon is added to the right-hand side of the equation.   The approach of this work is rather general. In particular, it applies to equations in bounded domains in R^d under Dirichlet boundary conditions.