We consider the Ginzburg-Landau functional with a variable applied magnetic field in a bounded and smooth two dimensional domain. The applied magnetic field varies smoothly and is allowed to vanish non-degenerately along a curve. Assuming that the strength of the applied magnetic field varies between two characteristic scales, and the Ginzburg-Landau parameter tends to +\infty, we determine an accurate asymptotic formula for the minimizing energy and show that the energy minimizers have vortices. The new aspect in the presence of a variable magnetic field is that the density of vortices in the sample is not uniform.