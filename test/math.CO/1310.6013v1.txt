The aim of this paper is to extend and generalise some work of Katona on the existence of perfect matchings or Hamilton cycles in graphs subject to certain constraints. The most general form of these constraints is that we are given a family of sets of edges of our graph and are not allowed to use all the edges of any member of this family. We consider two natural ways of expressing constraints of this kind using graphs and using set systems.   For the first version we ask for conditions on regular bipartite graphs G and H for there to exist a perfect matching in G, no two edges of which form a 4-cycle with two edges of H.   In the second, we ask for conditions under which a Hamilton cycle in the complete graph (or equivalently a cyclic permutation) exists, with the property that it has no collection of intervals of prescribed lengths whose union is an element of a given family of sets. For instance we prove that the smallest family of 4-sets with the property that every cyclic permutation of an n-set contains two adjacent pairs of points has size between (1/9+o(1))n^2 and (1/2-o(1))n^2. We also give bounds on the general version of this problem and on other natural special cases.   We finish by raising numerous open problems and directions for further study.