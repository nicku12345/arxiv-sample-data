Let A be a selfadjoint operator in a separable Hilbert space, K a selfadjoint Hilbert-Schmidt operator, and f\in C^n(\mathbb{R}). We establish that \varphi(t)=f(A+tK)-f(A) is n-times continuously differentiable on \mathbb{R} in the Hilbert-Schmidt norm, provided either A is bounded or the derivatives f^{(i)}, i=1,\ldots,n, are bounded. As an application of the second order \Sc^2-differentiability, we extend the Koplienko trace formula from the Besov class B_{\infty1}^2(\R) to functions f for which the divided difference f^{[2]} admits a certain Hilbert space factorization.