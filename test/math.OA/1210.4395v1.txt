A weak multiplier Hopf algebra is a pair (A,\Delta) of a non-degenerate idempotent algebra A and a coproduct \Delta on A. The coproduct is a coassociative homomorphism from A to the multiplier algebra M(A\otimes A) with some natural extra properties (like the existence of a counit). Further we impose extra but natural conditions on the ranges and the kernels of the canonical maps T_1 and T_2 defined from A\otimes A to M(A\otimes A) by T_1(a\otimes b)=\Delta(a)(1\otimes b) and T_2(a\ot b)=(a\otimes 1)\Delta(b).   The first condition is about the ranges of these maps. It is assumed that there exists an idempotent element E\in M(A\otimes A) such that \Delta(A)(1\ot A)=E(A\ot A) and (A\otimes 1)\Delta(A)=(A\otimes A)E. The second condition determines the behavior of the coproduct on the legs of E. We require (\Delta\otimes \iota)(E)=(\iota\otimes\Delta)(E)=(1\otimes E)(E\ot 1)=(E\otimes 1)(1\otimes E) where \iota is the identity map and where \Delta\otimes \iota and \iota\otimes\Delta are extensions to the multipier algebra M(A\otimes A). Finally, the last condition determines the kernels of the canonical maps T_1 and T_2 in terms of this idempotent E by a very specific relation.   From these conditions we develop the theory. In particular, we construct a unique antipode satisfying the expected properties and various other data. Special attention is given to the regular case (that is when the antipode is bijective) and the case of a *-algebra (where regularity is automatic).   Weak Hopf algebras are special cases of such weak multiplier Hopf algebras. Conversely, if the underlying algebra of a (regular) weak multiplier Hopf algebra has an identity, it is a weak Hopf algebra. Also any groupoid, finite or not, yields two weak multiplier Hopf algebras in duality.