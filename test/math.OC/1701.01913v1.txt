Demand response represents a significant but largely untapped resource that can greatly enhance the flexibility and reliability of power systems. This paper proposes a hierarchical control framework to facilitate the integrated coordination between distributed energy resources and demand response. The proposed framework consists of coordination and device layers. In the coordination layer, various resource aggregations are optimally coordinated in a distributed manner to achieve the system-level objectives. In the device layer, individual resources are controlled in real time to follow the optimal power dispatch signals received from the coordination layer. For practical applications, a method is presented to determine the utility functions of controllable loads by accounting for the real-time load dynamics and the preferences of individual customers. The effectiveness of the proposed framework is validated by detailed simulation studies.