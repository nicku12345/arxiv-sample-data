Let A and B be almost commuting (i.e, AB-BA\in\bS_1) self-adjoint operators. We construct a functional calculus \f\mapsto\f(A,B) for \f in the Besov class B_{\be,1}^1(\R^2). This functional calculus is linear, the operators \f(A,B) and \psi(A,B) almost commute for \f,\,\psi\in B_{\be,1}^1(\R^2), \f(A,B)=u(A)v(B) whenever \f(s,t)=u(s)v(t), and the Helton--Howe trace formula holds. The main tool is triple operator integrals.