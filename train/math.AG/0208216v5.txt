We study a generalization of Serre--Tate theory of ordinary abelian varieties and their deformation spaces. This generalization deals with abelian varieties equipped with additional structures. The additional structures can be not only an action of a semisimple algebra and a polarization, but more generally the data given by some ``crystalline Hodge cycles'' (a p-adic version of a Hodge cycle in the sense of motives). Compared to Serre--Tate ordinary theory, new phenomena appear in this generalized context.   We give an application of this theory to the existence of ``good'' integral models of those Shimura varieties whose adjoints are products of simple, adjoint Shimura varieties of D_l^{\bf H} type with l\ge 4.