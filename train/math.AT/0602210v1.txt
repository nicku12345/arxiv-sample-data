We show that the Chas-Sullivan loop product, a combination of the Pontrjagin product on the fiber and intersection product on the base, makes sense on the total space homology of any fiberwise monoid E over a closed oriented manifold M. More generally the Thom spectrum E^{-TM} is a ring spectrum. Similarly a fiberwise module over E defines a module over E^{-TM}. Fiberwise monoids include adjoint bundles of principal bundles, and the construction is natural with respect to maps of principal bundles. This naturality implies homotopy invariance of the algebra structure on H_*(LM) arising from the loop product. If M=BG is the infinite dimensional classifying space of a compact Lie group, then we get a well-defined pro-ring spectrum, which we define to be the string topology of BG. If E has a fiberwise action of the little n-cubes operad then E^{-TM} is an E_n-ring spectrum. This gives homology operations combining Dyer-Lashof operations on the fiber and Steenrod operations on the base. We give several examples where the new operations give homological insight, borrowed from knot theory, complex geometry, gauge theory, and homotopy theory.