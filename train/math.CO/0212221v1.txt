In this paper we prove that among the permutations of length n with i fixed points and j excedances, the number of 321-avoiding ones equals the number of 132-avoiding ones, for all given i,j<=n. We use a new technique involving diagonals of non-rational generating functions. This theorem generalizes a recent result of Robertson, Saracino and Zeilberger, for which we also give another, more direct proof.