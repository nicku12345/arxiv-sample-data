In the combinatorial study of the coefficients of a bivariate polynomial that generalizes both the length and the reflection length generating functions for finite Coxeter groups, Petersen introduced a new Mahonian statistic sor, called the sorting index. Petersen proved that the pairs of statistics (sor,cyc) and (inv,rl\textrm{-}min) have the same joint distribution over the symmetric group, and asked for a combinatorial proof of this fact. In answer to the question of Petersen, we observe a connection between the sorting index and the B-code of a permutation defined by Foata and Han, and we show that the bijection of Foata and Han serves the purpose of mapping (inv,rl\textrm{-}min) to (sor,cyc). We also give a type B analogue of the Foata-Han bijection, and we derive the quidistribution of (inv_B,{\rm Lmap_B},{\rm Rmil_B}) and (sor_B,{\rm Lmap_B},{\rm Cyc_B}) over signed permutations. So we get a combinatorial interpretation of Petersen's equidistribution of (inv_B,nmin_B) and (sor_B,l_B'). Moreover, we show that the six pairs of set-valued statistics \rm (Cyc_B,Rmil_B), \rm(Cyc_B,Lmap_B), \rm(Rmil_B,Lmap_B), \rm(Lmap_B,Rmil_B), \rm(Lmap_B,Cyc_B) and \rm(Rmil_B,Cyc_B) are equidistributed over signed permutations. For Coxeter groups of type D, Petersen showed that the two statistics inv_D and sor_D are equidistributed. We introduce two statistics nmin_D and \tilde{l}_D' for elements of D_n and we prove that the two pairs of statistics (inv_D,nmin_D) and (sor_D,\tilde{l}_D') are equidistributed.