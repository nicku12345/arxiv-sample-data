Let X be a compact manifold with boundary, and suppose that the boundary is the total space of a fibration with base Y and fibre Z. Let D be a generalized Dirac operator associated to a Phi-metric g on X. Under the assumption that D is fully elliptic we prove an index formula for D. The proof is in two steps: first, using results of Melrose and Rochon, we show that the index is unchanged if we pass to a certain b-metric h(s), with s a positive real number. Next we write the b- (i.e. the APS) index formula for h(s); the Phi-index formula follows by analyzing the limiting behaviour as s goes to zero of the two terms in the formula. The interior term is studied directly whereas the adiabatic limit formula for the eta invariant follows from work of Bismut and Cheeger.