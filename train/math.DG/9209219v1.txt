Let G\subset GL(V) be a linear Lie group with Lie algebra \frak g and let A(\frak g)^G be the subalgebra of G-invariant elements of the associative supercommutative algebra A(\frak g)= S(\frak g^*)\otimes \La(V^*). To any G-structure \pi:P\to M with a connection \omega we associate a homomorphism \mu_\omega:A(\frak g)^G\to \Omega(M). The differential forms \mu_\omega(f) for f\in A(\frak g)^G which are associated to the G-structure \pi can be used to construct Lagrangians. If \omega has no torsion the differential forms \mu_\omega(f) are closed and define characteristic classes of a G-structure. The induced homomorphism \mu'_\omega:A(\g)^G\to H^*(M) does not depend on the choice of the torsionfree connection \omega and it is the natural generalization of the Chern Weil homomorphism.