Quaternion derivatives in the mathematical literature are typically defined only for analytic (regular) functions. However, in engineering problems, functions of interest are often real-valued and thus not analytic, such as the standard cost function. The HR calculus is a convenient way to calculate formal derivatives of both analytic and non-analytic functions of quaternion variables, however, both the HR and other functional calculus in quaternion analysis have encountered an essential technical obstacle, that is, the traditional product rule is invalid due to the non- commutativity of the quaternion algebra. To address this issue, a generalized form of the HR derivative is proposed based on a general orthogonal system. The so introduced generalization, called the generalized HR (GHR) calculus, encompasses not just the left- and right-hand versions of quaternion derivative, but also enables solutions to some long standing problems, such as the novel product rule, the chain rule, the mean-valued theorem and Taylor's theorem. At the core of the proposed approach is the quaternion rotation, which can naturally be applied to other functional calculi in non-commutative settings. Examples on using the GHR calculus in adaptive signal processing support the analysis.