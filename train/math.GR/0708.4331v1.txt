We investigate the structure of subdirect products of groups, particularly their finiteness properties. We pay special attention to the subdirect products of free groups, surface groups and HNN extensions. We prove that a finitely presented subdirect product of free and surface groups virtually contains a term of the lower central series of the direct product or else fails to intersect one of the direct summands. This leads to a characterization of the finitely presented subgroups of the direct product of 3 free or surface groups, and to a solution to the conjugacy problem for arbitrary finitely presented subgroups of direct products of surface groups. We obtain a formula for the first homology of a subdirect product of two free groups and use it to show there is no algorithm to determine the first homology of a finitely generated subgroup.