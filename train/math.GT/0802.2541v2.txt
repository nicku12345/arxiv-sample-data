We prove that a metric space does not coarsely embed into a Hilbert space if and only if it satisfies a sequence of Poincar\'e inequalities, which can be formulated in terms of (generalized) expanders. We also give quantitative statements, relative to the compression. In the equivariant context, our result says that a group does not have the Haagerup property if and only if it has relative property T with respect to a family of probabilities whose supports go to infinity. We give versions of this result both in terms of unitary representations, and in terms of affine isometric actions on Hilbert spaces.