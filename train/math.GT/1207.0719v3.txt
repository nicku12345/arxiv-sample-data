By generalizing the Kuperberg sl(3) bracket, we construct a graph-valued analogue of the Homflypt sl(3) invariant for virtual knots. The restriction of this invariant for classical knots coincides with the usual Homflypt sl(3) invariant, and for virtual knots and graphs it provides new information that allows one to prove minimality theorems and to construct new invariants for free knots. We formulate this new invariant for virtual braids as well, and show that it leads to the construction of a trace function on the virtual Hecke algebra. Finally, we show that the Penrose coloring bracket is a special case of the Kuperberg bracket, and we raise new questions about the extension of the present work.