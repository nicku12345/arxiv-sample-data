In this paper, short-term throughput optimal power allocation policies are derived for an energy harvesting transmitter with energy storage losses. In particular, the energy harvesting transmitter is equipped with a battery that loses a fraction of its stored energy. Both single user, i.e. one transmitter-one receiver, and the broadcast channel, i.e., one transmitter-multiple receiver settings are considered, initially with an infinite capacity battery. It is shown that the optimal policies for these models are threshold policies. Specifically, storing energy when harvested power is above an upper threshold, retrieving energy when harvested power is below a lower threshold, and transmitting with the harvested energy in between is shown to maximize the weighted sum-rate. It is observed that the two thresholds are related through the storage efficiency of the battery, and are nondecreasing during the transmission. The results are then extended to the case with finite battery capacity, where it is shown that a similar double-threshold structure arises but the thresholds are no longer monotonic. A dynamic program that yields an optimal online power allocation is derived, and is shown to have a similar double-threshold structure. A simpler online policy is proposed and observed to perform close to the optimal policy.