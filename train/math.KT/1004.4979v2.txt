The construction of the Leavitt path algebra associated to a directed graph E is extended to incorporate a family C consisting of partitions of the sets of edges emanating from the vertices of E. The new algebras, L_K(E,C), are analyzed in terms of their homology, ideal theory, and K-theory. These algebras are proved to be hereditary, and it is shown that any conical abelian monoid occurs as the monoid \mon{L_K(E,C)} of isomorphism classes of finitely generated projective modules over one of these algebras. The lattice of trace ideals of L_K(E,C) is determined by graph-theoretic data, namely as a lattice of certain pairs consisting of a subset of E^0 and a subset of C. Necessary conditions for \mon{L_K(E,C)} to be a refinement monoid are developed, together with a construction that embeds (E,C) in a separated graph (E_+,C^+) such that \mon{L_K(E_+,C^+)} has refinement.