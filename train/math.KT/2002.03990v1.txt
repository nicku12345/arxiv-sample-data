The quantum Lefschetz formula explains how virtual fundamental classes (or structure sheaves) of moduli stacks of stable maps behave when passing from an ambient target scheme to the zero locus of a section. It is only valid under special assumptions (genus 0, regularity of the section and convexity of the bundle). In this paper, we give a general statement at the geometric level removing these assumptions, using derived geometry. Through a study of the structure sheaves of derived zero loci we deduce a categorification of the formula in the \infty-categories of quasi-coherent sheaves. We also prove that Manolache's virtual pullbacks can be constructed as derived pullbacks, and use them to get back the classical Quantum Lefschetz formula when the hypotheses are satisfied.