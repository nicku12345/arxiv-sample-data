We consider the time-dependent Schr\"odinger equation on a Riemannian manifold \mathcal{A} with a potential that localizes a certain class of states close to a fixed submanifold \mathcal{C}. When we scale the potential in the directions normal to \mathcal{C} by a parameter \varepsilon\ll 1, the solutions concentrate in an \veps-neighborhood of \mathcal{C}. We derive an effective Schr\"odinger equation on the submanifold \mathcal{C} and show that its solutions, suitably lifted to \mathcal{A}, approximate the solutions of the original equation on \mathcal{A} up to errors of order \varepsilon^3|t| at time t. Furthermore, we prove that the eigenvalues of the corresponding effective Hamiltonian below a certain energy coincide up to errors of order \varepsilon^3 with those of the full Hamiltonian under reasonable conditions.   Our results hold in the situation where tangential and normal energies are of the same order, and where exchange between these energies occurs. In earlier results tangential energies were assumed to be small compared to normal energies, and rather restrictive assumptions were needed, to ensure that the separation of energies is maintained during the time evolution. Most importantly, we can allow for constraining potentials that change their shape along the submanifold, which is the typical situation in the applications to quantum wave guides and to quantum molecular dynamics.   In order to explain the meaning and the relevance of some of the terms in the effective Hamiltonian, we analyze in some detail the application to quantum wave guides, where \mathcal{C} is a curve in \mathcal{A}=\mathbb{R}^3. This allows us to generalize two recent results on spectra of such wave guides.