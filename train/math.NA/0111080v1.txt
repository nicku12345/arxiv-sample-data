Several strategies in phase retrieval are unified by an iterative "difference map" constructed from a pair of elementary projections and a single real parameter \beta. For the standard application in optics, where the two projections implement Fourier modulus and object support constraints respectively, the difference map reproduces the "hybrid" form of Fienup's input-output map for \beta = 1. Other values of \beta are equally effective in retrieving phases but have no input-output counterparts. The geometric construction of the difference map illuminates the distinction between its fixed points and the recovered object, as well as the mechanism whereby stagnation is avoided. When support constraints are replaced by object histogram or atomicity constraints, the difference map lends itself to crystallographic phase retrieval. Numerical experiments with synthetic data suggest that structures with hundreds of atoms can be solved.