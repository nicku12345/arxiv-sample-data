The paper presents an automatic generator of approximate nonreflecting boundary conditions, analytical and numerical, for scalar wave equations. This generator has two main ingredients. The first one is a set of local Trefftz functions -- outgoing waves approximating the solution in the vicinity of a given point of the exterior boundary of the computational domain. The second ingredient is a set of linear test functionals (degrees of freedom). One example of such functionals is the nodal values of the solution at a set of grid points; in that case, one obtains a numerical condition -- a finite difference scheme at the boundary. Alternatively, the functionals may involve derivatives or integrals of the solution, in which case the proposed "Trefftz machine" yields analytical nonreflecting conditions. Corners and edges are treated algorithmically the same way as straight boundaries. With specific choices of bases and degrees of freedom, the machine produces classical conditions such as Engquist-Majda and Bayliss-Turkel. For other choices, one obtains a variety of analytical and numerical conditions, a few of which are presented as illustrative examples.