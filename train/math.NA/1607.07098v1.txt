In this work, a second-order approximation of the fractional substantial derivative is presented by considering a modified shifted substantial Gr\"{u}nwald formula and its asymptotic expansion. Moreover, the proposed approximation is applied to a fractional diffusion equation with fractional substantial derivative in time. With the use of the fourth-order compact scheme in space, we give a fully discrete Gr\"{u}nwald-Letnikov-formula-based compact difference scheme and prove its stability and convergence by the energy method under smooth assumptions. In addition, the problem with nonsmooth solution is also discussed, and an improved algorithm is proposed to deal with the singularity of the fractional substantial derivative. Numerical examples show the reliability and efficiency of the scheme.