All the results in this paper are conditional on the Riemann Hypothesis for the L-functions of elliptic curves. Under this assumption, we show that the average analytic rank of all elliptic curves over Q is at most 2, thereby improving a result of Brumer. We also show that the average within any family of quadratic twists is at most 3/2, improving a result of Goldfeld. A third result concerns the density of curves with analytic rank at least R, and shows that the proportion of such curves decreases faster than exponentially as R grows. The proofs depend on an analogue of Weil's ``explicit formula''.