We prove a new automorphy lifting theorem for l-adic representations where we impose a new condition at l, which we call `potential diagonalizability'. This result allows for `change of weight' and seems to be substantially more flexible than previous theorems along the same lines. We derive several applications. For instance we show that any irreducible, odd, essentially self-dual, regular, weakly compatible system of l-adic representations of the absolute Galois group of a totally real field is potentially automorphic, and hence is pure and its L-function has meromorphic continuation to the whole complex plane and satisfies the expected functional equation.