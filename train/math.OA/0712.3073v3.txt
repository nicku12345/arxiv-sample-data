Let (G,P) be a quasi-lattice ordered group and let X be a compactly aligned product system over P of Hilbert bimodules. Under mild hypotheses we associate to X a C*-algebra which we call the Cuntz-Nica-Pimsner algebra of X. Our construction generalises a number of others: a sub-class of Fowler's Cuntz-Pimsner algebras for product systems of Hilbert bimodules; Katsura's formulation of Cuntz-Pimsner algebras of Hilbert bimodules; the C*-algebras of finitely aligned higher-rank graphs; and Crisp and Laca's boundary quotients of Toeplitz algebras. We show that for a large class of product systems X, the universal representation of X in its Cuntz-Nica-Pimsner algebra is isometric.