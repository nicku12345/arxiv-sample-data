We prove that ample groupoids with sigma-compact unit spaces are equivalent if and only if they are stably isomorphic in an appropriate sense, and relate this to Matui's notion of Kakutani equivalence. We use this result to show that diagonal-preserving stable isomorphisms of graph C*-algebras or Leavitt path algebras give rise to isomorphisms of the groupoids of the associated stabilised graphs. We deduce that the Leavitt path algebras L_Z(E_2) and L_Z(E_{2-}) are not stably *-isomorphic.