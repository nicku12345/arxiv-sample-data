A new directional derivative and a new subdifferential for set-valued convex functions are constructed, and a set-valued version of the so-called 'max-formula' is proven. The new concepts are used to characterize solutions of convex optimization problems with a set-valued objective. As a major tool, a residuation operation is used which acts in a space of closed convex, but not necessarily bounded subsets of a topological linear space. The residuation serves as a substitute for the inverse addition and is intimately related to the Minkowski or geometric difference of convex sets. The results, when specialized, even extend those for extended real-valued convex functions since the improper case is included.