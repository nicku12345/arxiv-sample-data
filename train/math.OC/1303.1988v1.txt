We propose a new LMI approach to the design of optimal switching sequences for polynomial dynamical systems with state constraints. We formulate the switching design problem as an optimal control problem which is then relaxed to a linear programming (LP) problem in the space of occupation measures. This infinite-dimensional LP can be solved numerically and approximately with a hierarchy of convex finite-dimensional LMIs. In contrast with most of the existing work on LMI methods, we have a guarantee of global optimality, in the sense that we obtain an asympotically converging (i.e. with vanishing conservatism) hierarchy of lower bounds on the achievable performance. We also explain how to construct an almost optimal switching sequence.