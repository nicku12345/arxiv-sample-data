As we transition towards a power grid that is increasingly based on renewable resources like solar and wind, the intelligent control of distributed energy resources (DER) including photovoltaic (PV) arrays, controllable loads, energy storage and plug-in electric vehicles (EVs) will be critical to realizing a power grid that can handle both the variability and unpredictability of renewable energy sources as well as increasing system complexity. Realizing such a decentralized and dynamic infrastructure will require the ability to solve large scale problems in real-time with hundreds of thousands of DERs simultaneously online. Because of the scale of the optimization problem, we use an iterative distributed algorithm previously developed in our group to operate each DER independently and autonomously within this environment. The algorithm is deployed within a framework that allows the microgrid to dynamically adapt to changes in the operating environment. Specifically, we consider a commercial site equipped with on-site PV generation, partially curtailable load, EV charge stations and a battery electric storage (BES) unit. The site operates as a small microgrid that can participate in the wholesale market on the power grid. We report results for simulations using real data that demonstrate the ability of the optimization framework to respond dynamically in real-time to external conditions while maintaining the functional requirements of all DERs.