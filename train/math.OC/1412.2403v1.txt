We find a maximum principle for general non-Markovian semi-martingales. We do so by describing the adjoint processes with non-anticipating stochastic derivatives in a martingale random field setting. In the case of the L\'evy processes this extends maximum principles with Malliavin derivatives, in the sense that we replace Malliavin differentiability conditions with weaker and simpler L_2-conditions.   As an application we use the maximum principle to solve a portfolio optimization problem for assets with credit risk modeled by doubly stochastic Poisson processes.