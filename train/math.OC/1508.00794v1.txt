This paper presents a flexible and modular control scheme based on distributed model predictive control (DMPC) to achieve optimal operation of decentralized energy systems in smart grids. The proposed approach is used to coordinate multiple distributed energy resources (DERs) in a low voltage (LV) microgrid and therefore, allow virtual power plant (VPP) operation. A sequential and iterative DMPC formulation is shown which incorporates global grid targets along with the local comfort requirements and performance indices. The preliminary results generated by the simulation of a studied case proves the benefits of applying such a control scheme to a benchmark low voltage microgrid.