In this paper, a stochastic approximation (SA) based distributed algorithm is proposed to solve the resource allocation (RA) with uncertainties. In this problem, a group of agents cooperatively optimize a separable optimization problem with a linear network resource constraint and allocation feasibility constraints, where the global objective function is the sum of agents' local objective functions. Each agent can only get noisy observations of its local function's gradient and its local resource, which cannot be shared by other agents or transmitted to a center. Moreover, there are communication uncertainties such as time-varying topologies (described by random graphs) and additive channel noises. To solve the RA, we propose an SA-based distributed algorithm, and prove that agents can collaboratively achieve the optimal allocation with probability one by virtue of ordinary differential equation (ODE) method for SA. Finally, simulations related to the demand response management in power systems verify the effectiveness of the proposed algorithm.