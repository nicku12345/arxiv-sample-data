We prove existence and regularity of optimal shapes for the problem\min\Big\{P(\Omega)+\mathcal{G}(\Omega):\ \Omega\subset D,\ |\Omega|=m\Big\},where P denotes the perimeter, |\cdot| is the volume, and the functional \mathcal{G} is either one of the following:\textless{}ul\textgreater{}\textless{}li\textgreater{} the Dirichlet energy E\_f, with respect to a (possibly sign-changing) function f\in L^p;\textless{}/li\textgreater{}\textless{}li\textgreater{}a spectral functional of the form F(\lambda\_{1},\dots,\lambda\_{k}), where \lambda\_k is the kth eigenvalue of the Dirichlet Laplacian and F:\mathbb{R}^k\to\mathbb{R} is Lipschitz continuous and increasing in each variable.\textless{}/li\textgreater{}\textless{}/ul\textgreater{}The domain D is the whole space \mathbb{R}^d or a bounded domain. We also give general assumptions on the functional \mathcal{G} so that the result remains valid.