A two-stage optimization method is proposed for optimal distributed generation (DG) planning considering the integration of energy storage in this paper. The first stage determines the installation locations and the initial capacity of DGs using the well-known loss sensitivity factor (LSF) approach, and the second stage identifies the optimal installation capacities of DGs to maximize the investment benefits and system voltage stability and to minimize line losses. In the second stage, the multi-objective ant lion optimizer (MOALO) is first applied to obtain the Pareto-optimal solutions, and then the 'best' compromise solution is identified by calculating the priority memberships of each solution via grey relation projection (GRP) method, while finally, in order to address the uncertain outputs of DGs, energy storage devices are installed whose maximum outputs are determined with the use of chance-constrained programming. The test results on the PG&E 69-bus distribution system demonstrate that the proposed method is superior to other current state-of-the-art approaches, and that the integration of energy storage makes the DGs operate at their pre-designed rated capacities with the probability of at least 60% which is novel.