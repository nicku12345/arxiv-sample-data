Consider the random graph on n vertices 1, ..., n. Each vertex i is assigned a type X_i with X_1, ..., X_n being independent identically distributed as a nonnegative discrete random variable X. We assume that {\bf E} X^3<\infty. Given types of all vertices, an edge exists between vertices i and j independent of anything else and with probability \min \{1, \frac{X_iX_j}{n}(1+\frac{a}{n^{1/3}}) \}. We study the critical phase, which is known to take place when {\bf E} X^2=1. We prove that normalized by n^{-2/3} the asymptotic joint distributions of component sizes of the graph equals the joint distribution of the excursions of a reflecting Brownian motion B^a(s) with diffusion coefficient \sqrt{{\bf E}X{\bf E}X^3} and drift a-\frac{{\bf E}X^3}{{\bf E}X}s. This shows that finiteness of {\bf E}X^3 is the necessary condition for the diffusion limit. In particular, we conclude that the size of the largest connected component is of order n^{2/3}.