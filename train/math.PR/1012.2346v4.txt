Guided by the relationship between the breadth-first walk of a rooted tree and its sequence of generation sizes, we are able to include immigration in the Lamperti representation of continuous-state branching processes. We provide a representation of continuous-state branching processes with immigration by solving a random ordinary differential equation driven by a pair of independent Levy processes. Stability of the solutions is studied and gives, in particular, limit theorems (of a type previously studied by Grimvall, Kawazu and Watanabe and by Li) and a simulation scheme for continuous-state branching processes with immigration. We further apply our stability analysis to extend Pitman's limit theorem concerning Galton-Watson processes conditioned on total population size to more general offspring laws.