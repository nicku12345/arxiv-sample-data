The allocation problem for a d-dimensional Poisson point process is to find a way to partition the space to parts of equal size, and to assign the parts to the configuration points in a measurable, "deterministic" (equivariant) way. The goal is to make the diameter R of the part assigned to a configuration point have fast decay. We present an algorithm for d\geq3 that achieves an O(\operatorname {exp}(-cR^d)) tail, which is optimal up to c. This improves the best previously known allocation rule, the gravitational allocation, which has an \operatorname {exp}(-R^{1+o(1)}) tail. The construction is based on the Ajtai-Koml\'{o}s-Tusn\'{a}dy algorithm and uses the Gale-Shapley-Hoffman-Holroyd-Peres stable marriage scheme (as applied to allocation problems).