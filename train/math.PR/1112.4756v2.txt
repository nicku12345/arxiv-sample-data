This paper has been withdrawn by the author as it has been divided into two separate papers.