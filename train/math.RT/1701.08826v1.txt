W.Specht (1940) proved that two n\times n complex matrices A and B are unitarily similar if and only if \operatorname{trace} w(A,A^{\ast}) = \operatorname{trace} w(B,B^{\ast}) for every word w(x,y) in two noncommuting variables. We extend his criterion and its generalizations by N.A.Wiegmann (1961) and N.Jing (2015) to an arbitrary system \mathcal A consisting of complex or real inner product spaces and linear mappings among them. We represent such a system by the directed graph Q(\mathcal A), whose vertices are inner product spaces and arrows are linear mappings. Denote by \widetilde Q(\mathcal A) the directed graph obtained by enlarging to Q(\mathcal A) the adjoint linear mappings. We prove that a system \mathcal A is transformed by isometries of its spaces to a system \mathcal B if and only if the traces of all closed directed walks in \widetilde Q(\mathcal A) and \widetilde Q(\mathcal B) coincide.