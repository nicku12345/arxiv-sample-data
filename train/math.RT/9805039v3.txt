In this paper we introduce generalized Spencer cohomology for finite depth Z-graded Lie (super)algebras. We develop a method of finding filtered deformations of such Z-graded Lie (super)algebras based on this cohomology. As an application we determine all simple filtered deformations of certain Z-graded Lie superalgebras classified in [K3], thus completing the last step in the classification of simple infinite-dimensional linearly compact Lie superalgebras.