We construct a compactification of the moduli space of twisted holomorphic maps with varying complex structure and bounded energy. For a given compact symplectic manifold X with a compatible complex structure and a Hamiltonian action of S^1 with moment map \mu:X\to\imag\RR, the moduli space which we compactify consists of equivalence classes of tuples (C,P,A,\phi), where C is a smooth compact complex curve of fixed genus, P is a principal S^1 bundle over C, A is a connection on P and \phi is a section of P\times_{S^1}X satisfying \ov{\partial}_A\phi=0,\qquad \iota_{v}F_A+\mu(\phi)=c, where F_A is the curvature of A, v is the restriction on C of a volume form on the universal curve over \oM_g and c is a fixed constant. Two tuples (C,P,A,\phi) and (C',P',A',\phi') are equivalent if there is a morphism of bundles \rho:P\to P' lifting a biholomorphism C\to C' such that \rho^*A'=A and \rho^*\phi'=\phi. The energy of (C,P,A,\phi) is \|F_A\|_{L^2}^2+\|d_A\phi\|_{L^2}^2 +\|\mu(\phi)-c\|_{L^2}^2, and the topology of the moduli space is the natural one. We also incorporate marked points in the picture.   There are two sources of non compactness. First, bubbling off phenomena, analogous to the one in Gromov--Witten theory. Second, degeneration of C to nodal curves. In this case, there appears a phenomenon which is not present in Gromov--Witten: near the nodes, the section \phi may degenerate to a chain of gradient flow lines of -\imag\mu.