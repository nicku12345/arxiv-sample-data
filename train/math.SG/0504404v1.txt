Let K be a rationally null-homologous knot in a three-manifold Y. We construct a version of knot Floer homology in this context, including a description of the Floer homology of a three-manifold obtained as Morse surgery on the knot K. As an application, we express the Heegaard Floer homology of rational surgeries on Y along a null-homologous knot K in terms of the filtered homotopy type of the knot invariant for K. This has applications to Dehn surgery problems for knots in S^3. In a different direction, we use the techniques developed here to calculate the Heegaard Floer homology of an arbitrary Seifert fibered three-manifold.