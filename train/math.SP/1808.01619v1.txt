Under certain assumptions we derive a complete semiclassical asymptotics of the spectral function e_{h,\varepsilon}(x,x,\lambda) for a scalar operator   \begin{equation*} A_\varepsilon (x,hD)= A^0(hD) + \varepsilon B(x,hD), \end{equation*} where A^0 is an elliptic operator and B(x,hD) is a periodic or almost periodic perturbation.   In particular, a complete semiclassical asymptotics of the integrated density of states also holds. Further, we consider generalizations.