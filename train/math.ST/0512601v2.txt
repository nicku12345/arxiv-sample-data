We consider a density estimation problem arising in nuclear physics. Gamma photons are impinging on a semiconductor detector, producing pulses of current. The integral of this pulse is equal to the total amount of charge created by the photon in the detector, which is linearly related to the photon energy. Because the inter-arrival of photons can be shorter than the charge collection time, pulses corresponding to different photons may overlap leading to a phenomenon known as pileup. The distortions on the photon energy spectrum estimate due to pileup become worse when the photon rate increases, making pileup correction techniques a must for high counting rate experiments. In this paper, we present a novel technique to correct pileup, which extends a method introduced in \cite{hall:park:2004} for the estimation of the service time from the busy period in M/G/\infty models. It is based on a novel formula linking the joint distribution of the energy and duration of the cluster of pulses and the distribution of the energy of the photons. We then assess the performance of this estimator by providing an expression of its integrated square error. A Monte-Carlo experiment is presented to illustrate on practical examples the benefits of the pileup correction.