We propose a class of rank-based procedures for testing that the shape matrix \mathbf{V} of an elliptical distribution (with unspecified center of symmetry, scale and radial density) has some fixed value {\mathbf{V}}_0; this includes, for {\mathbf{V}}_0={\mathbf{I}}_k, the problem of testing for sphericity as an important particular case. The proposed tests are invariant under translations, monotone radial transformations, rotations and reflections with respect to the estimated center of symmetry. They are valid without any moment assumption. For adequately chosen scores, they are locally asymptotically maximin (in the Le Cam sense) at given radial densities. They are strictly distribution-free when the center of symmetry is specified, and asymptotically so when it must be estimated. The multivariate ranks used throughout are those of the distances--in the metric associated with the null value {\mathbf{V}}_0 of the shape matrix--between the observations and the (estimated) center of the distribution. Local powers (against elliptical alternatives) and asymptotic relative efficiencies (AREs) are derived with respect to the adjusted Mauchly test (a modified version of the Gaussian likelihood ratio procedure proposed by Muirhead and Waternaux [Biometrika 67 (1980) 31--43]) or, equivalently, with respect to (an extension of) the test for sphericity introduced by John [Biometrika 58 (1971) 169--174]. For Gaussian scores, these AREs are uniformly larger than one, irrespective of the actual radial density. Necessary and/or sufficient conditions for consistency under nonlocal, possibly nonelliptical alternatives are given. Finite sample performances are investigated via a Monte Carlo study.