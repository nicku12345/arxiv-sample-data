We propose a wavelet-based technique for the nonparametric estimation of functions contaminated with noise whose mean and variance are linked via a possibly unknown variance function. Our method, termed the data-driven wavelet-Fisz technique, consists of estimating the variance function via a Nadaraya-Watson estimator, and then performing a wavelet thresholding procedure which uses the estimated variance function and local means of the data to set the thresholds at a suitable level. We demonstrate the mean-square near-optimality of our wavelet estimator over the usual range of Besov classes. To achieve this, we establish an exponential inequality for the Nadaraya-Watson variance function estimator. We discuss various implementation issues concerning our wavelet estimator, and demonstrate its good practical performance. We also show how it leads to a new wavelet-domain data-driven variance-stabilising transform. Our estimator can be applied to a variety of problems, including the estimation of volatilities, spectral densities and Poisson intensities, as well as to a range of problems in which the distribution of the noise is unknown.