Many time series exhibit changes both in level and in variability. Generally, it is more important to detect a change in the level, and changing or smoothly evolving variability can confound existing tests. This paper develops a framework for testing for shifts in the level of a series which accommodates the possibility of changing variability. The resulting tests are robust both to heteroskedasticity and serial dependence. They rely on a new functional central limit theorem for dependent random variables whose variance can change or trend in a substantial way. This new result is of independent interest as it can be applied in many inferential contexts applicable to time series. Its application to change point tests relies on a new approach which utilizes Karhunen--Lo{\'e}ve expansions of the limit Gaussian processes. After presenting the theory in the most commonly encountered setting of the detection of a change point in the mean, we show how it can be extended to linear and nonlinear regression. Finite sample performance is examined by means of a simulation study and an application to yields on US treasury bonds.